# SeedVR2 Video Upscaler - Docker Compose
# Privacy-safe deployment with host volume mounts

services:
  seedvr2:
    image: neosun/seedvr2-allinone:latest
    container_name: seedvr2-upscaler
    restart: unless-stopped
    ports:
      - "${PORT:-8200}:8200"
    volumes:
      # Privacy-safe: files stored on host, not in container
      - ${UPLOAD_DIR:-/tmp/seedvr2-docker-allinone/uploads}:/app/uploads
      - ${OUTPUT_DIR:-/tmp/seedvr2-docker-allinone/outputs}:/app/outputs
    environment:
      - NVIDIA_VISIBLE_DEVICES=${NVIDIA_VISIBLE_DEVICES:-all}
      - GPU_IDLE_TIMEOUT=${GPU_IDLE_TIMEOUT:-600}
      - DEFAULT_RESOLUTION=${DEFAULT_RESOLUTION:-1080}
      - DEFAULT_BATCH_SIZE=${DEFAULT_BATCH_SIZE:-5}
      - MAX_UPLOAD_SIZE=${MAX_UPLOAD_SIZE:-500}
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8200/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

# Alternative: Maximum privacy with tmpfs (memory storage)
# Uncomment below and comment out the volumes section above
#
#  seedvr2-tmpfs:
#    image: neosun/seedvr2-allinone:latest
#    container_name: seedvr2-upscaler-tmpfs
#    restart: unless-stopped
#    ports:
#      - "${PORT:-8200}:8200"
#    tmpfs:
#      - /app/uploads:size=10G
#      - /app/outputs:size=50G
#    environment:
#      - NVIDIA_VISIBLE_DEVICES=${NVIDIA_VISIBLE_DEVICES:-all}
#    deploy:
#      resources:
#        reservations:
#          devices:
#            - driver: nvidia
#              count: 1
#              capabilities: [gpu]
